# Intro
During my "Vulnerability" course, I had to find a honeypot, configure it, and deploy it! I was aware of other honeypots such as "Cowrie" but I wanted something different and new. As I am a person who is passionate about AI, how it works, LLM languages and so on... I found "SheLLM" to be a really good project. It was also my first time discovering a honeypot based on AI responses... So fascinating. I dove into this project easily.

# Scenario, deployment, personalization 
## Scenario 
So in order to make the project more realistic, I decided to create a whole realistic attack scenario. I imagined a corporation that has its website (yes I even faked a website) and in the website it has a link to their GitHub repo. And in the commits of one of the projects on GitHub, there is a "Git commit leaking SSH keys". Now how did I make this "SheLLM" have an IP address available to the public? And how did I personalize it? Scripts for alerts? etc...

Some context: the name of the company was `Build Pro`, a company specialized in construction and building, and the user we want to use as a honeypot user is Kaiser (an engineer who works at Build Pro company).

## How did I manage it?

### VM Preparation:


- Installation of an Ubuntu 22.04 LTS virtual machine in bridge mode to
expose it on the local network. To configure the VM, simply follow this tutorial: https://linuxsimply.com/linux-basics/os-installation/virtual-machine/ubuntu-on-vmware/ ; the installation was done on VMware.

- Creation of the kaiser user:
```sh
sudo adduser kaiser
sudo usermod --shell /usr/local/bin/shelLM-kaiser kaiser
```

- The user was added to the AllowUsers list in `/etc/ssh/sshd_config` to
limit SSH access:
```sh
AllowUsers kaiser
```
- Restart of the SSH service -> `sudo systemctl restart sshd`


### Installation and configuration of shelLM

- Creation of the .env file with the OpenAI API key:
`echo 'OPENAI_API_KEY="sk-…"' | sudo tee /opt/shelLM-kaiser/.env`
- Installation of Python dependencies and other dependencies like `jq` and `dos2unix`(conversion of files to UNIX format to avoid errors)...:
```sh
pip3 install -r requirements.txt
sudo apt install -y git python3-pip dos2unix jq
```

- Assignment of permissions to the folder:
```sh
sudo chown -R kaiser:kaiser /opt/shelLM-kaiser
sudo chmod 600 /opt/shelLM-kaiser/.env
sudo chown kaiser:kaiser /opt/shelLM-kaiser/.env
```

- Creation of the fake shell (shelLM-Kaiser):
```sh
sudo tee /usr/local/bin/shelLM-kaiser <<'EOF'
#!/usr/bin/env bash
cd /opt/shelLM-kaiser
exec python3 LinuxSSHbot.py
EOF
sudo chmod +x /usr/local/bin/shelLM-kaiser
sudo chown root:root /usr/local/bin/shelLM-kaiser
```

This shell simulates a complete Linux session controlled by an LLM. Add the
shell to the list of authorized shells:
```sh
echo "/usr/local/bin/shelLM-kaiser" | sudo tee -a /etc/shells
```
- Personality customization. In the `personalitySSH.yml` file, the following elements were configured:
    - Username: kaiser
    - Host: buildpro
    - Directories: Blueprints, Contracts, SitePlans, etc.
    - Realistic terminal behavior (errors on sudo, credible files, response
    only to real Linux commands).


### Session logging and monitoring

By default, shelLM records the commands typed by the attacker in a file called
`history.txt`. But this file is not very usable as is:


- It also contains all the honeypot configuration (personalitySSH.yml) at the
    beginning of the file.
- It is difficult to read the logs properly.
- And especially, the IP address displayed comes from a fake "Last login" line generated by
the model, so not reliable at all.


To fix this, I wrote a Python script called `shelLM-logcleaner.py`. This script runs
continuously and cleans up `history.txt`:
- It retrieves only the useful lines (the commands executed by
the attacker with their timestamp).
- It rewrites them cleanly in another file: `/var/log/shelLM/sessions.log`.


Now, the final format is simple and readable. But this script does not retrieve the IP address, because like i said `history.txt` does not contain the real IP of
the attacker. Moreover, for this script to run all the time, a systemd service was created.
Here is its configuration:
```sh
[Unit]
Description=Convert shelLM history to session log
After=network.target
[Service]
User=kaiser
ExecStart=/usr/local/bin/shelLM-logcleaner.py
Restart=always
[Install]
WantedBy=multi-user.target
```

This service allows the script to start automatically at each machine boot.
It is activated with these commands:
```sh
sudo systemctl daemon-reload
sudo systemctl enable --now shelLM-logcleaner.service
```
Since `logcleaner.py` does not handle the IP, I created a second script, this time in Bash, which
takes care of sending the logs to Discord. This script monitors two files in real time:
- `/var/log/auth.log` → this file contains the real SSH connections of the system
(successful or failed).
- `/var/log/shelLM/sessions.log` → the cleaned commands.

Operation:
- When a user connects via SSH (or fails their password), the IP is
detected and stored.
- When a command is executed, it is sent to a Discord webhook
with the last known IP.
- Everything is sent in a clear message, with a small emoji to identify the type
of action (connection, error, command, disconnection...).


<br>

# Contact

Feel free to reach out via :

Email: elfaijahanas@gmail.com
LinkedIn : https://www.linkedin.com/in/anaselfaijah/



<br>


# Credit

This honeypot implementation uses SheLLM by Sladic, M., Valeros, V., Catania, C., & Garcia, S. (2023) (Stratosphere Laboratory, CTU Prague) as its base framework, with custom modifications for enhanced logging and monitoring capabilities. https://github.com/stratosphereips/SheLLM